<div class="step1-container">
	<h2 class="mat-headline-5">
		<mat-icon color="primary">cloud_upload</mat-icon>
		&nbsp; 1) Subir archivo
	</h2>

	<div class="step-content">
		<mat-card *ngIf="!fileUploaded">
			<mat-card-content>
				<div class="upload-area">
					<div class="upload-content">
						<div
							class="file-drop-area mat-elevation-z1"
							(drop)="onFileDrop($event)"
							(dragover)="onDragOver($event)"
							(dragleave)="onDragLeave($event)"
							[class.mat-elevation-z4]="isDragOver()"
							[class.mat-primary]="isUploading()">
							@if (isUploading()) {
							<mat-spinner diameter="40"></mat-spinner>
							<p class="mat-body-1">Subiendo archivo...</p>
							} @else {
							<mat-icon
								class="upload-icon"
								color="primary"
								>cloud_upload</mat-icon
							>
							<p class="mat-body-1 mat-muted">Arrastra tu archivo Excel aquí</p>
							}

							<input
								#fileInput
								type="file"
								accept=".xlsx,.xls"
								(change)="onFileSelected($event)"
								style="display: none" />
						</div>

						@if (selectedFile(); as file) {
						<div class="selected-file-info mat-elevation-z1">
							<mat-icon color="primary">description</mat-icon>
							<span class="mat-body-1">{{ file.name }}</span>
						</div>
						}

						<!-- 📊 Estado del upload -->
						@if (uploadStatus()) {
						<div
							class="mat-body-1"
							[class.mat-error]="uploadStatus().includes('❌')"
							[class.mat-success]="uploadStatus().includes('✓')">
							{{ uploadStatus() }}
						</div>
						}
					</div>
				</div>
				<div class="buttons-container">
					<button
						mat-stroked-button
						color="primary"
						style="margin-top: 1.5rem"
						(click)="fileInput.click()"
						[disabled]="isUploading()">
						<mat-icon>folder_open</mat-icon>
						Elegir archivo
					</button>
					<button
						mat-raised-button
						color="primary"
						[disabled]="!selectedFile() || isUploading()"
						(click)="onFileUpload()"
						style="margin-top: 1.5rem">
						@if (isUploading()) {
						<mat-spinner diameter="16"></mat-spinner>
						<span>Subiendo...</span>
						} @else {
						<ng-container>
							<mat-icon>cloud_upload</mat-icon>
							<span>Subir archivo</span>
						</ng-container>
						}
					</button>
				</div>
			</mat-card-content>
		</mat-card>

		<mat-card *ngIf="fileUploaded">
			<mat-card-content>
				<div class="success-message">
					<mat-icon
						color="primary"
						class="success-icon"
						>check_circle</mat-icon
					>
					<div>
						<p class="mat-body-1">
							<strong>Archivo:</strong> {{ fileStateService.filename() || 'excel para test.xlsx' }}
						</p>
						<p class="mat-body-1"><strong>File ID:</strong> {{ fileStateService.fileId() }}</p>
						<p class="mat-body-1"><strong>Estado:</strong> ✅ Cargado exitosamente</p>
						<p class="mat-body-2">
							¡El archivo se cargó correctamente! Ahora puedes continuar con el siguiente paso.
						</p>
					</div>
				</div>
			</mat-card-content>
		</mat-card>
	</div>
</div>
